{
  "schemaVersion": 1,
  "items": {
    "mem-artifact-builder": {
      "id": "mem-artifact-builder",
      "title": "Deterministic artifact extraction",
      "description": "Generate decisions, constraints, outcomes, open threads, and transcript segments from canonical logs.",
      "acceptanceCriteria": [
        "Artifact schema includes ids, session/task/run refs, type, content, provenance, builder_version.",
        "Deterministic extractors produce outcome, decision, constraint, open_thread, and transcript artifacts.",
        "Dedup/supersedes rules consolidate repeated decisions/constraints.",
        "Unit tests validate extraction and dedup behavior."
      ],
      "prompt": "Implement deterministic artifact extraction from canonical logs (decisions, constraints, outcomes, open threads, transcript segments). Store artifacts with provenance and builder_version in a durable store. Add unit tests for extraction and dedup/supersedes behavior.",
      "parentId": null,
      "childIds": [],
      "deps": [
        "mem-canonicalizer"
      ],
      "status": "done",
      "createdAt": "2026-02-03T05:30:54.934013Z",
      "updatedAt": "2026-02-03T06:33:22.63897Z"
    },
    "mem-canonicalizer": {
      "id": "mem-canonicalizer",
      "title": "Canonicalize trace into message timeline",
      "description": "Convert raw trace events into canonical messages/tool calls with provenance.",
      "acceptanceCriteria": [
        "Canonicalizer reconstructs assistant text from streaming deltas and normalizes provider payloads.",
        "Outputs include messages, tool calls/results, metadata, and provenance mapping to trace offsets.",
        "Canonical logs are stored per run in memory storage for replay.",
        "Unit tests cover SSE delta assembly and provenance mapping."
      ],
      "prompt": "Build a canonicalizer in internal/memory that replays WAL events into a canonical timeline of messages/tool calls (including provenance back to trace offsets). Persist canonical logs per run and write unit tests for SSE delta reassembly and provenance mapping.",
      "parentId": null,
      "childIds": [],
      "deps": [
        "mem-trace-store"
      ],
      "status": "done",
      "createdAt": "2026-02-03T05:30:54.934013Z",
      "updatedAt": "2026-02-03T06:18:48.993113Z"
    },
    "mem-cli-commands": {
      "id": "mem-cli-commands",
      "title": "Memory CLI commands",
      "description": "Expose memory search/get/context commands in the CLI.",
      "acceptanceCriteria": [
        "`blackbird mem search` supports query + session/task filters and prints bounded results.",
        "`blackbird mem get` outputs full artifact details.",
        "`blackbird mem context` builds and prints the session context pack for a task.",
        "CLI tests cover flag parsing and output formatting."
      ],
      "prompt": "Add `blackbird mem` subcommands (search/get/context) that use the retrieval API and context pack builder. Support session/task filters and bounded outputs. Add CLI tests for parsing and formatting.",
      "parentId": null,
      "childIds": [],
      "deps": [
        "mem-index-retrieval",
        "mem-context-pack"
      ],
      "status": "done",
      "createdAt": "2026-02-03T05:30:54.934013Z",
      "updatedAt": "2026-02-03T07:09:30.09818Z"
    },
    "mem-config-session": {
      "id": "mem-config-session",
      "title": "Memory config and session identity",
      "description": "Introduce memory configuration, session metadata, and path helpers for durable memory storage.",
      "acceptanceCriteria": [
        "Config schema includes a memory section (mode, proxy, retention, budgets) with defaults and validation applied in load/resolve.",
        "Session metadata persists under `.blackbird/memory/session.json` with a stable session_id and optional goal.",
        "Helpers resolve memory root, trace WAL paths, and artifact/index DB paths.",
        "Unit tests cover config parsing/merging and session create/load."
      ],
      "prompt": "Add a memory configuration section to internal/config (raw + resolved) with defaults and validation. Implement session metadata persistence and path helpers under a new internal/memory package. Ensure codex-only defaults are explicit and provide unit tests for config merge and session create/load.",
      "parentId": null,
      "childIds": [],
      "deps": [],
      "status": "done",
      "createdAt": "2026-02-03T05:30:54.934013Z",
      "updatedAt": "2026-02-03T05:45:42.913777Z"
    },
    "mem-context-pack": {
      "id": "mem-context-pack",
      "title": "Session context pack builder",
      "description": "Assemble bounded session context packs from artifacts with stable ordering and budgets.",
      "acceptanceCriteria": [
        "Context pack includes session goal, key decisions/constraints, recent outcomes, open threads, and artifact IDs.",
        "Section budgets enforced with stable ordering and deduplication.",
        "Includes instruction text for memory tool usage/limits.",
        "Unit tests cover budgeting and ordering."
      ],
      "prompt": "Implement a context pack builder that assembles a session context download from artifacts with per-section token budgets and stable ordering. Include instruction text for memory tool usage limits. Add tests for budgeting and ordering behavior.",
      "parentId": null,
      "childIds": [],
      "deps": [
        "mem-index-retrieval"
      ],
      "status": "done",
      "createdAt": "2026-02-03T05:30:54.934013Z",
      "updatedAt": "2026-02-03T06:59:20.052889Z"
    },
    "mem-docs-log": {
      "id": "mem-docs-log",
      "title": "Documentation and agent log updates",
      "description": "Document memory system usage, config, and storage layout; update AGENT_LOG.",
      "acceptanceCriteria": [
        "docs/CONFIGURATION.md updated with memory settings and proxy behavior.",
        "docs/FILES_AND_STORAGE.md updated with memory storage paths.",
        "README/docs updated with codex-only note and memory CLI usage.",
        "AGENT_LOG.md updated with a durable memory implementation summary."
      ],
      "prompt": "Update documentation to cover memory configuration, proxy behavior, storage paths, and CLI usage, including a codex-only note. Append a summary of the work to AGENT_LOG.md.",
      "parentId": null,
      "childIds": [],
      "deps": [
        "mem-cli-commands",
        "mem-execution-integration",
        "mem-proxy-lifecycle"
      ],
      "status": "done",
      "createdAt": "2026-02-03T05:30:54.934013Z",
      "updatedAt": "2026-02-03T08:08:48.460883Z"
    },
    "mem-execution-integration": {
      "id": "mem-execution-integration",
      "title": "Execution integration with memory",
      "description": "Embed memory context into execution packs and propagate session/task/run IDs for codex runs.",
      "acceptanceCriteria": [
        "ContextPack schema includes session/run metadata and memory context pack payload.",
        "BuildContext (or new builder) attaches memory pack for codex when enabled; no-op for Claude.",
        "Agent launch sets proxy base URL/headers for codex using provider adapter; IDs are propagated.",
        "Execution/resume tests updated for new fields and gating."
      ],
      "prompt": "Update execution context building to include memory session/run metadata and the session context pack when provider is codex and memory is enabled. Ensure LaunchAgent/RunExecute propagate IDs to the proxy (base URL prefix or headers) using the provider adapter, and skip for Claude. Update execution/resume tests accordingly.",
      "parentId": null,
      "childIds": [],
      "deps": [
        "mem-context-pack",
        "mem-provider-adapters",
        "mem-config-session"
      ],
      "status": "done",
      "createdAt": "2026-02-03T05:30:54.934013Z",
      "updatedAt": "2026-02-03T07:28:44.335221Z"
    },
    "mem-index-retrieval": {
      "id": "mem-index-retrieval",
      "title": "Lexical index and retrieval API",
      "description": "Index artifacts for fast search and implement search/get/related APIs.",
      "acceptanceCriteria": [
        "Lexical index (SQLite FTS5 or equivalent) supports scoped search with type/recency weighting.",
        "Search returns bounded cards with snippet and provenance; Get returns full artifacts.",
        "Related expands adjacency based on provenance/task/run links.",
        "Unit tests cover scoring, filtering, and snippet bounds."
      ],
      "prompt": "Build a lexical index over artifacts (SQLite FTS5 or equivalent) and implement a retrieval API with Search/Get/Related. Incorporate session/task scoping, type/recency weighting, and bounded snippets. Add unit tests for scoring and filters.",
      "parentId": null,
      "childIds": [],
      "deps": [
        "mem-artifact-builder"
      ],
      "status": "done",
      "createdAt": "2026-02-03T05:30:54.934013Z",
      "updatedAt": "2026-02-03T06:45:46.606225Z"
    },
    "mem-provider-adapters": {
      "id": "mem-provider-adapters",
      "title": "Provider adapter interface (codex first)",
      "description": "Define a provider adapter interface for memory capture/injection with codex implementation and Claude stub.",
      "acceptanceCriteria": [
        "Adapter interface covers proxy routing rules, base URL prefix/headers, and enabled check.",
        "Codex adapter implements routing/path rewrite per the investigation doc and defines ID propagation strategy.",
        "Claude adapter returns disabled/no-op while preserving extension points.",
        "Tests verify adapter selection and gating behavior."
      ],
      "prompt": "Create an internal/memory/provider package that defines a provider adapter interface (routing rules, base URL prefix/header strategy, enabled check). Implement codex adapter with the path rewrite rules from DURABLE_MEMORY_INVESTIGATION and a no-op Claude adapter for future extension. Add unit tests for selection and gating.",
      "parentId": null,
      "childIds": [],
      "deps": [
        "mem-config-session"
      ],
      "status": "done",
      "createdAt": "2026-02-03T05:30:54.934013Z",
      "updatedAt": "2026-02-03T05:52:27.950903Z"
    },
    "mem-proxy-core": {
      "id": "mem-proxy-core",
      "title": "Reverse proxy flight recorder",
      "description": "Build streaming reverse proxy for Codex traffic and capture events to the trace store.",
      "acceptanceCriteria": [
        "Proxy forwards requests to correct upstream (API vs ChatGPT backend) with path rewrite rules.",
        "Streaming SSE/chunked responses are passed through without buffering.",
        "Each request is captured into WAL with generated request_id and session/task/run IDs from the adapter.",
        "Tests validate routing, streaming passthrough, redaction, and ID tagging."
      ],
      "prompt": "Implement a streaming reverse proxy (internal/memory/proxy or cmd/reverse-proxy) that routes Codex traffic per the investigation doc, preserves streaming, and records trace events via the WAL. Use the provider adapter to extract/tag session/task/run IDs and add redaction. Add httptest-based tests for routing, streaming, and capture tagging.",
      "parentId": null,
      "childIds": [],
      "deps": [
        "mem-trace-store",
        "mem-provider-adapters"
      ],
      "status": "done",
      "createdAt": "2026-02-03T05:30:54.934013Z",
      "updatedAt": "2026-02-03T07:48:27.175401Z"
    },
    "mem-proxy-lifecycle": {
      "id": "mem-proxy-lifecycle",
      "title": "Proxy lifecycle management",
      "description": "Start/stop proxy with Blackbird lifecycle and ensure safe single-instance behavior.",
      "acceptanceCriteria": [
        "TUI start launches the proxy and shuts it down on exit; CLI execute/resume start/stop when needed.",
        "Graceful shutdown and port conflict handling with clear errors.",
        "Proxy only starts for supported providers and when memory is enabled.",
        "Tests cover lifecycle gating and shutdown."
      ],
      "prompt": "Add a proxy supervisor that starts the memory proxy when Blackbird opens (TUI start) and during CLI execute/resume runs, then shuts down cleanly. Handle port conflicts and no-op for unsupported providers or disabled memory. Add lifecycle tests for gating and shutdown.",
      "parentId": null,
      "childIds": [],
      "deps": [
        "mem-proxy-core",
        "mem-provider-adapters",
        "mem-config-session"
      ],
      "status": "done",
      "createdAt": "2026-02-03T05:30:54.934013Z",
      "updatedAt": "2026-02-03T08:03:37.594577Z"
    },
    "mem-trace-store": {
      "id": "mem-trace-store",
      "title": "Trace WAL storage",
      "description": "Implement append-only trace event store with redaction, rotation, and replay.",
      "acceptanceCriteria": [
        "Trace event schema supports request/response start/body/end/error with timestamps and IDs.",
        "WAL writer appends in order with fsync strategy, rotation by size/age, and retention pruning.",
        "Redaction strips sensitive headers and optional body capture obeys privacy mode.",
        "Reader replays events in order; unit tests cover ordering, rotation, and redaction."
      ],
      "prompt": "Implement a trace WAL in internal/memory/trace with an event schema aligned to DURABLE_MEMORY_CONTEXT_PACKS (request/response start/body/end/error). Add redaction and privacy-mode body capture, rotation/retention, and a replay reader. Write unit tests for order, redaction, and rotation.",
      "parentId": null,
      "childIds": [],
      "deps": [
        "mem-config-session"
      ],
      "status": "done",
      "createdAt": "2026-02-03T05:30:54.934013Z",
      "updatedAt": "2026-02-03T06:04:14.731616Z"
    }
  }
}
