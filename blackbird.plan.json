{
  "schemaVersion": 1,
  "items": {
    "prqg_01": {
      "id": "prqg_01",
      "title": "Execution Data Contracts for Parent Review",
      "description": "Establish the execution-layer data model needed for parent review runs and review-driven resume feedback. This deliverable defines durable contracts before trigger, orchestration, and UI wiring are added.",
      "acceptanceCriteria": [
        "Run records can represent both normal execution runs and parent review runs without breaking existing decode paths.",
        "Execution query helpers can deterministically retrieve review runs and child run context needed by reviewer inputs.",
        "Pending parent-review feedback can be persisted, loaded, overwritten, and cleared per child task.",
        "Unit tests cover JSON compatibility, deterministic ordering, and persistence round-trips for the new contracts."
      ],
      "prompt": "Implement the parent-review execution contracts in internal/execution first: update run-record types, add query helpers for review flows, and add durable pending-feedback storage primitives with tests. Keep APIs small, deterministic, and dependency-light.",
      "parentId": null,
      "childIds": [
        "prqg_01a",
        "prqg_01b",
        "prqg_01c",
        "prqg_01d"
      ],
      "deps": [],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T05:38:31.277955Z"
    },
    "prqg_01a": {
      "id": "prqg_01a",
      "title": "Add RunType and Parent Review Outcome Fields",
      "description": "Extend execution run records so parent review runs are first-class persisted artifacts instead of overloaded task runs. Include explicit review outcome fields required for downstream trigger/idempotence and resume routing.",
      "acceptanceCriteria": [
        "internal/execution/types.go defines a run type enum with at least execute and review values.",
        "RunRecord includes run-type and parent-review outcome fields (passed, resume task IDs, feedback text, completion signature) with stable JSON keys.",
        "Existing run records without the new fields still decode successfully and preserve prior behavior.",
        "internal/execution/types_test.go covers marshal/unmarshal for old and new record shapes."
      ],
      "prompt": "Modify internal/execution/types.go and internal/execution/types_test.go to add explicit parent-review run modeling. Preserve backward compatibility and keep JSON tags/omitempty behavior deterministic so existing persisted runs continue to load.",
      "parentId": "prqg_01",
      "childIds": [],
      "deps": [],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T05:26:26.155124Z"
    },
    "prqg_01b": {
      "id": "prqg_01b",
      "title": "Add Review-Run Query Helpers",
      "description": "Add deterministic query helpers for review runs so orchestration can fetch latest review attempts and perform signature-based idempotence checks without duplicating file-scanning logic.",
      "acceptanceCriteria": [
        "internal/execution/query_test.go creates mixed execute/review run fixtures and asserts review lookup helpers exclude execute runs.",
        "Tests verify latest-review selection returns the expected review run ID for a parent when multiple review runs exist.",
        "Tests verify signature-filtered latest-review selection returns the expected run for a matching signature and a not-found result when no match exists.",
        "Tests verify deterministic ordering for tied timestamps by asserting a stable secondary key (for example lexical run ID ordering)."
      ],
      "prompt": "Implement review-specific lookup helpers in internal/execution/query.go (or a nearby execution query file) and add tests in internal/execution/query_test.go. Keep behavior deterministic and avoid re-reading/parsing the same runs at multiple call sites.",
      "parentId": "prqg_01",
      "childIds": [],
      "deps": [
        "prqg_01a"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T05:30:01.931229Z"
    },
    "prqg_01c": {
      "id": "prqg_01c",
      "title": "Implement Pending Parent-Feedback Store",
      "description": "Create a dedicated persistence layer for pending parent-review feedback assigned to child tasks. This storage should support explicit resume-by-child flows without mutating historical run records.",
      "acceptanceCriteria": [
        "A storage API exists to upsert, load, and clear pending parent-review feedback by child task ID.",
        "Stored data includes parentTaskID, reviewRunID, feedback text, and created/updated timestamps.",
        "Writes are atomic and constrained to the workspace run-data root (no traversal outside expected directories).",
        "Unit tests cover round-trip persistence, overwrite behavior, clear behavior, and missing-file reads."
      ],
      "prompt": "Add a new execution storage module (for example internal/execution/parent_review_feedback_store.go) and tests. Persist pending review feedback under .blackbird with deterministic file layout and reuse existing atomic write patterns where possible.",
      "parentId": "prqg_01",
      "childIds": [],
      "deps": [
        "prqg_01a"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T05:33:23.393669Z"
    },
    "prqg_01d": {
      "id": "prqg_01d",
      "title": "Add Deterministic Child-Run Context Retrieval",
      "description": "Provide a shared helper that retrieves each child task's latest completed run in stable child order for parent-review context construction. This prevents duplicated run-selection logic across review components.",
      "acceptanceCriteria": [
        "A helper returns child run context for a parent task in deterministic child ID order.",
        "The helper validates that each referenced child has a completed run record before review execution.",
        "Missing or non-terminal child runs return actionable errors that include child IDs.",
        "Tests cover deterministic ordering, missing-run handling, and mixed child status edge cases."
      ],
      "prompt": "Implement reusable child-run retrieval helpers in internal/execution using plan childIds and execution run queries. Add focused tests that make downstream parent-review context assembly predictable and easy to verify.",
      "parentId": "prqg_01",
      "childIds": [],
      "deps": [
        "prqg_01b"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T05:38:31.277955Z"
    },
    "prqg_02": {
      "id": "prqg_02",
      "title": "Trigger and Idempotence Engine for Parent Reviews",
      "description": "Implement the deterministic engine that decides when a parent review should run and guarantees at-most-once execution per all-children-done event signature.",
      "acceptanceCriteria": [
        "Parent-review candidates are detected only for non-leaf tasks whose children are all done.",
        "A deterministic child-completion signature is computed and used for idempotence checks.",
        "Execution hooks can ask the trigger engine whether a review should run without UI coupling.",
        "Tests prove no duplicate reviews for unchanged signatures and re-triggering after child rework."
      ],
      "prompt": "Build parent-review trigger/idempotence logic in internal/execution as reusable pure helpers plus a small orchestration hook callable from RunExecute and RunResume. Keep trigger math deterministic and side-effect boundaries explicit.",
      "parentId": null,
      "childIds": [
        "prqg_02a",
        "prqg_02b",
        "prqg_02c",
        "prqg_02d"
      ],
      "deps": [
        "prqg_01"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T05:58:14.530922Z"
    },
    "prqg_02a": {
      "id": "prqg_02a",
      "title": "Implement Parent Candidate Discovery",
      "description": "Detect which parents become review candidates when a child transitions to done, including nested parent chains. Candidates must be container tasks only and must have all children done.",
      "acceptanceCriteria": [
        "Candidate discovery ignores leaf tasks and parents with empty childIds.",
        "Only parents whose full child sets are done are returned as candidates.",
        "Ancestor traversal supports multi-level hierarchies and returns deterministic order.",
        "Unit tests cover single parent, nested parents, and partially done child sets."
      ],
      "prompt": "Add parent-candidate discovery helpers in internal/execution (new file is fine) that accept a graph plus changed child ID and return candidate parent IDs for review. Keep the function deterministic and side-effect free. Verify by adding table-driven tests for single-parent, nested-parent, and partially-done scenarios, then run `go test ./internal/execution -run ParentCandidate` (or the new test file) successfully.",
      "parentId": "prqg_02",
      "childIds": [],
      "deps": [
        "prqg_01a"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T05:41:36.110042Z"
    },
    "prqg_02b": {
      "id": "prqg_02b",
      "title": "Add Child-Completion Signature and Idempotence Check",
      "description": "Create a stable signature representing the all-children-done event for a parent so repeated execute loops do not rerun the same review without new child completion changes.",
      "acceptanceCriteria": [
        "Unit tests show signature generation returns the same value for identical child-completion inputs across repeated invocations.",
        "Unit tests with shuffled child input ordering (map iteration and slice order) produce identical signatures for equivalent completion state.",
        "Unit tests show signature output changes when any child completion timestamp changes or when the completed-child set changes.",
        "Idempotence helper tests show review is skipped when the latest stored review signature matches and required when signature is missing or different."
      ],
      "prompt": "Implement signature/idempotence helpers in internal/execution that pair with review-run query APIs. Add tests that assert stability and changed-state detection, including edge cases with reordered maps.",
      "parentId": "prqg_02",
      "childIds": [],
      "deps": [
        "prqg_01b"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T05:46:59.779492Z"
    },
    "prqg_02c": {
      "id": "prqg_02c",
      "title": "Build Parent Review Gate Orchestration Hook",
      "description": "Create a small orchestration hook that integrates candidate discovery and idempotence checks, then delegates actual review execution through a callback boundary used by RunExecute/RunResume.",
      "acceptanceCriteria": [
        "Hook accepts plan path/graph context and returns a typed result indicating pass, pause-required, or no-op.",
        "The hook invokes review execution only for candidates that pass idempotence checks.",
        "The hook supports deterministic processing order when multiple parent candidates are ready.",
        "Unit tests use mocked review callbacks to verify invocation count and ordering behavior."
      ],
      "prompt": "Add a reusable orchestration function in internal/execution that composes candidate discovery + signature idempotence and calls a supplied review-run executor callback. Keep it decoupled from CLI/TUI output concerns. Verify with mocked-callback tests that assert invocation ordering, invocation count, and no-op behavior, then run `go test ./internal/execution -run ParentReviewGate` (or equivalent).",
      "parentId": "prqg_02",
      "childIds": [],
      "deps": [
        "prqg_02a",
        "prqg_02b"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T05:53:32.181994Z"
    },
    "prqg_02d": {
      "id": "prqg_02d",
      "title": "Add Trigger/Idempotence Regression Tests",
      "description": "Add focused execution-level regression tests that validate parent-review trigger semantics across repeated loops and child rework cycles.",
      "acceptanceCriteria": [
        "Tests show a parent review runs once when the final child becomes done.",
        "Tests show no duplicate review for repeated loads/execution loops with unchanged signatures.",
        "Tests show a new review is triggered after child status leaves done and later returns to done.",
        "Tests are deterministic and do not depend on wall-clock sleeps."
      ],
      "prompt": "Write tests in internal/execution (new *_test.go file is fine) to validate trigger/idempotence behavior end-to-end at the orchestration layer. Prefer explicit timestamps and deterministic fixtures.",
      "parentId": "prqg_02",
      "childIds": [],
      "deps": [
        "prqg_02c"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T05:58:14.530922Z"
    },
    "prqg_03": {
      "id": "prqg_03",
      "title": "Parent Review Run Execution and Structured Outcome Parsing",
      "description": "Implement the dedicated parent review run path: build reviewer input context, execute a review run for the parent task, parse structured pass/fail output, and persist review outcomes.",
      "acceptanceCriteria": [
        "Parent review runs use a dedicated run type and reviewer-specific system prompt.",
        "Review context includes parent acceptance criteria plus bounded context from completed child runs.",
        "Structured review responses are validated, including child-ID mapping and feedback requirements on failure.",
        "Failed reviews persist resume targets and feedback linkage for downstream resume actions."
      ],
      "prompt": "Create the dedicated parent-review execution path in internal/execution, including context building, run launch, response parsing, and persistence of review outcome/linkage data for resume flows.",
      "parentId": null,
      "childIds": [
        "prqg_03a",
        "prqg_03b",
        "prqg_03c",
        "prqg_03d"
      ],
      "deps": [
        "prqg_01"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T06:18:28.274553Z"
    },
    "prqg_03a": {
      "id": "prqg_03a",
      "title": "Build Parent Review Context Composer",
      "description": "Compose deterministic reviewer input from parent task data and completed child run artifacts/summaries. Keep context bounded and explicit so the reviewer evaluates rather than implements.",
      "acceptanceCriteria": [
        "`internal/execution` context-composer tests assert the generated review payload contains the parent task ID, title, full acceptance criteria list, and reviewer instruction text with exact fixture values.",
        "Tests with intentionally unsorted child IDs assert emitted child context entries are ordered by child ID and each entry contains the expected child ID plus latest-run summary/artifact references from fixtures.",
        "Tests with oversized child summaries assert bounding is enforced by checking output summary length is at or below the configured limit and truncation behavior is deterministic for the same input.",
        "Tests with missing optional child summaries assert payload generation still succeeds and produces deterministic fallback fields (for example empty summary values) without dropping required child metadata.",
        "`go test ./internal/execution -run ParentReviewContext` passes."
      ],
      "prompt": "Implement a parent-review context builder in internal/execution (new file recommended) that consumes plan + child run data and returns a deterministic context pack tailored for review runs. Add/extend tests to validate payload shape, ordering, bounded-size behavior, and missing-summary fallback; verify by running `go test ./internal/execution -run ParentReviewContext` (or equivalent).",
      "parentId": "prqg_03",
      "childIds": [],
      "deps": [
        "prqg_01d"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T06:03:43.313478Z"
    },
    "prqg_03b": {
      "id": "prqg_03b",
      "title": "Add Dedicated Parent Review Runner",
      "description": "Add an execution helper that launches parent review runs with RunType=review and reviewer constraints, while reusing existing launch/stream/run-record infrastructure.",
      "acceptanceCriteria": [
        "Review runner launches through existing agent runtime infrastructure with run type set to review.",
        "System prompt clearly restricts behavior to review/assessment and no implementation changes.",
        "Run records preserve provider/session metadata and capture stdout/stderr like normal execution runs.",
        "Tests assert run type, prompt content presence, and successful persistence of review runs."
      ],
      "prompt": "Implement a dedicated parent review run helper in internal/execution (for example RunParentReview) that reuses LaunchAgentWithStream but marks run type and reviewer semantics explicitly. Add targeted tests.",
      "parentId": "prqg_03",
      "childIds": [],
      "deps": [
        "prqg_03a",
        "prqg_01a"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T06:08:27.909797Z"
    },
    "prqg_03c": {
      "id": "prqg_03c",
      "title": "Parse and Validate Review Response Schema",
      "description": "Implement strict parsing/validation for parent review responses so downstream behavior is deterministic and safe. Invalid responses should fail clearly instead of silently continuing.",
      "acceptanceCriteria": [
        "Parser accepts structured responses containing passed plus failure fields when passed=false.",
        "Validation enforces unique non-empty resume task IDs and that IDs are a subset of the parent's child IDs.",
        "Validation requires non-empty feedback text when review fails.",
        "Tests cover valid pass, valid fail, malformed JSON, unknown child IDs, and missing required fields."
      ],
      "prompt": "Add response parsing/validation utilities in internal/execution for parent review outputs, reusing existing JSON extraction patterns where practical. Return actionable errors with enough context for CLI/TUI messaging.",
      "parentId": "prqg_03",
      "childIds": [],
      "deps": [
        "prqg_03b"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T06:12:22.064218Z"
    },
    "prqg_03d": {
      "id": "prqg_03d",
      "title": "Persist Review Outcome and Link Resume Targets",
      "description": "Persist parsed parent review outcomes in review run records and create pending feedback linkage for each child selected for rework.",
      "acceptanceCriteria": [
        "On failed review, persisted review run records include pass/fail outcome fields, sorted resume task IDs, feedback text, and the child-completion signature.",
        "For each resume target child, pending-feedback storage contains an entry with the expected parentTaskID, reviewRunID, and feedback text.",
        "On passed review, persistence writes the review outcome and leaves pending-feedback storage unchanged for all child tasks.",
        "internal/execution tests cover pass and fail paths and assert linkage entries are only present when the corresponding review run record exists."
      ],
      "prompt": "Wire parent-review parse results into persistence in internal/execution: enrich review run records and upsert per-child pending feedback entries. Keep write order safe (run saved before linkage) and add focused tests.",
      "parentId": "prqg_03",
      "childIds": [],
      "deps": [
        "prqg_03c",
        "prqg_01c",
        "prqg_02b"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T06:18:28.274553Z"
    },
    "prqg_04": {
      "id": "prqg_04",
      "title": "Resume-With-Parent-Feedback Execution Plumbing",
      "description": "Extend resume execution so pending parent-review feedback is injected into resumed task context and consumed with explicit, deterministic semantics.",
      "acceptanceCriteria": [
        "Resume context composition can include a parent-review feedback section without breaking existing waiting-user resume behavior.",
        "RunResume can resolve feedback from explicit input or pending parent-review storage with clear precedence.",
        "Pending feedback is cleared only after a resume run is successfully launched/persisted.",
        "Regression tests cover happy path, conflict path, and failure retention semantics."
      ],
      "prompt": "Implement the shared execution plumbing that injects parent-review feedback into resumes and manages pending-feedback lifecycle. Keep behavior explicit, deterministic, and fully covered by execution tests.",
      "parentId": null,
      "childIds": [
        "prqg_04a",
        "prqg_04b",
        "prqg_04c",
        "prqg_04d"
      ],
      "deps": [
        "prqg_01",
        "prqg_03"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T06:46:39.614145Z"
    },
    "prqg_04a": {
      "id": "prqg_04a",
      "title": "Extend ContextPack With Parent Review Feedback Section",
      "description": "Add explicit context-pack fields for parent-review feedback so resumed sessions receive the original task context plus reviewer findings in a machine-readable section.",
      "acceptanceCriteria": [
        "ContextPack includes an optional parent-review feedback section with parent ID, review run ID, and feedback text.",
        "Field is omitted from JSON when empty to preserve prior payload compatibility.",
        "Helper utilities can append feedback to context without mutating unrelated fields/slices.",
        "types/context tests verify serialization and merge behavior."
      ],
      "prompt": "Update internal/execution/types.go and context-related helpers/tests so resumed contexts can carry parent-review feedback as structured data. Keep schema additive and backward compatible.",
      "parentId": "prqg_04",
      "childIds": [],
      "deps": [
        "prqg_01a"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T06:25:31.369735Z"
    },
    "prqg_04b": {
      "id": "prqg_04b",
      "title": "Add Pending Feedback Resolution and Precedence Helper",
      "description": "Centralize how RunResume resolves feedback source: explicit CLI/TUI feedback, pending parent feedback, or none. This avoids diverging rules between interfaces.",
      "acceptanceCriteria": [
        "A helper resolves resume feedback source with deterministic precedence rules.",
        "Combining answers with feedback-triggered resume is rejected with a clear error.",
        "Resolved helper output includes source metadata (explicit vs pending parent review).",
        "Unit tests cover no-feedback, explicit-feedback, pending-feedback, and invalid mixed-input cases."
      ],
      "prompt": "Implement feedback-source resolution in internal/execution and wire it for reuse by RunResume and interface wrappers. Keep validation strict and error text actionable.",
      "parentId": "prqg_04",
      "childIds": [],
      "deps": [
        "prqg_04a",
        "prqg_01c"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T06:36:58.959663Z"
    },
    "prqg_04c": {
      "id": "prqg_04c",
      "title": "Wire RunResume to Consume/Clear Pending Parent Feedback",
      "description": "Integrate pending parent feedback into the core RunResume flow so CLI and TUI automatically get consistent behavior through shared execution APIs.",
      "acceptanceCriteria": [
        "RunResume can launch feedback-based resume when pending parent feedback exists for the target child task.",
        "RunResume clears pending feedback only after a run record is successfully produced and persisted.",
        "If resume fails before a run is created, pending feedback remains available for retry.",
        "Waiting-user question resume path remains unchanged when no feedback applies."
      ],
      "prompt": "Update internal/execution/runner.go to resolve pending parent feedback, inject it into resume context/input, and manage clear-on-success semantics. Add/extend runner tests for lifecycle behavior.",
      "parentId": "prqg_04",
      "childIds": [],
      "deps": [
        "prqg_04b"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T06:41:41.472533Z"
    },
    "prqg_04d": {
      "id": "prqg_04d",
      "title": "Add Resume Feedback Injection Regression Tests",
      "description": "Add detailed tests for resume-with-parent-feedback behavior, including provider constraints and failure handling, to prevent regressions in critical resume semantics.",
      "acceptanceCriteria": [
        "`internal/execution/resume_feedback_test.go` includes cases that assert resumed context payloads contain parent-review feedback fields (`parentTaskID`, `reviewRunID`, `feedback`) matching fixture values exactly.",
        "Failure-path tests simulate provider/session-ref launch errors and assert `RunResume` returns an error, writes no new run record, and leaves pending parent feedback persisted with unchanged content.",
        "Conflict-path tests assert mixed answers+feedback inputs return a deterministic validation error and verify the resume launcher mock is not invoked (zero run-start attempts).",
        "Success-path tests assert pending parent feedback is cleared only after successful run creation/persistence by verifying the new run record exists before/with feedback removal and feedback lookup returns not found afterward.",
        "`go test ./internal/execution -run ResumeFeedback` and `go test ./internal/execution -run RunResume` both pass, and existing waiting-user resume tests in the same package remain green."
      ],
      "prompt": "Expand internal/execution/resume_feedback_test.go and internal/execution/runner_test.go (or add dedicated tests) to validate pending feedback injection and retention semantics under success and error conditions.",
      "parentId": "prqg_04",
      "childIds": [],
      "deps": [
        "prqg_04c"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T06:46:39.614145Z"
    },
    "prqg_05": {
      "id": "prqg_05",
      "title": "CLI Parent Review Pause-and-Resume UX",
      "description": "Add explicit CLI behavior for parent review failures: pause execution, show review findings/resume targets, and require explicit child resume commands with injected feedback.",
      "acceptanceCriteria": [
        "blackbird execute reports parent review progress and pauses when review fails with resume targets.",
        "CLI output clearly shows parent ID, child IDs requiring rework, and feedback summary text.",
        "blackbird resume \u003ctaskId\u003e can resume from pending parent feedback without waiting-question prompts.",
        "CLI tests cover pass-through behavior, fail-and-pause behavior, and resume-from-pending behavior."
      ],
      "prompt": "Implement CLI integration in internal/cli so parent review failures become explicit user-facing checkpoints and resume flows consume stored parent feedback. Keep output deterministic for tests.",
      "parentId": null,
      "childIds": [
        "prqg_05a",
        "prqg_05b",
        "prqg_05c",
        "prqg_05d"
      ],
      "deps": [
        "prqg_02",
        "prqg_03",
        "prqg_04"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T07:07:29.583526Z"
    },
    "prqg_05a": {
      "id": "prqg_05a",
      "title": "Add Execute Stop Reason for Parent Review Required",
      "description": "Extend execution stop semantics so RunExecute can signal that parent review failed and execution is intentionally paused for user action.",
      "acceptanceCriteria": [
        "ExecuteStopReason includes a distinct parent_review_required value.",
        "RunExecute returns this reason when a parent review fails and identifies child resume targets.",
        "Execution loop does not automatically continue to other ready tasks after this stop reason.",
        "Tests validate stop reason propagation and halted loop behavior."
      ],
      "prompt": "Update internal/execution/runner.go and related tests to propagate a dedicated parent-review-required stop reason through ExecuteResult when review outcomes require explicit user rework decisions.",
      "parentId": "prqg_05",
      "childIds": [],
      "deps": [
        "prqg_02c",
        "prqg_03d"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T06:53:43.231384Z"
    },
    "prqg_05b": {
      "id": "prqg_05b",
      "title": "Render CLI Parent Review Failure Summary",
      "description": "Add deterministic CLI rendering for parent review outcomes so users can see exactly which child tasks need resume and what feedback will be injected.",
      "acceptanceCriteria": [
        "CLI prints a parent review start/progress line when review runs.",
        "On review failure, output includes parent task ID, sorted resume task IDs, and feedback text/excerpt.",
        "Output includes explicit next-step instructions using blackbird resume \u003ctaskId\u003e.",
        "Tests assert expected lines and deterministic ordering of resume targets."
      ],
      "prompt": "Update internal/cli/execute.go and helper formatting code to render parent-review outcomes. Keep messages concise, deterministic, and test-friendly.",
      "parentId": "prqg_05",
      "childIds": [],
      "deps": [
        "prqg_05a"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T07:00:34.160907Z"
    },
    "prqg_05c": {
      "id": "prqg_05c",
      "title": "Extend CLI Resume Command for Pending Parent Feedback",
      "description": "Teach blackbird resume to first resolve pending parent-review feedback and run feedback-based resume when present, then fall back to waiting-user question flow.",
      "acceptanceCriteria": [
        "`internal/cli/resume.go` resolves pending parent feedback before waiting-user question discovery.",
        "CLI resume tests verify that when pending feedback exists, resume runs without prompting for question answers.",
        "CLI resume tests verify pending feedback is cleared after a successful feedback-based resume launch.",
        "CLI resume tests verify existing waiting-user prompt behavior is unchanged when no pending feedback exists."
      ],
      "prompt": "Modify internal/cli/resume.go to integrate the new execution pending-feedback path from RunResume. Preserve current question/answer UX when pending feedback is absent. Verify by extending resume tests and running `go test ./internal/cli -run Resume` (or equivalent targeted tests).",
      "parentId": "prqg_05",
      "childIds": [],
      "deps": [
        "prqg_04c"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T07:03:45.495992Z"
    },
    "prqg_05d": {
      "id": "prqg_05d",
      "title": "Add CLI Parent Review Flow Tests",
      "description": "Add CLI-focused tests that exercise execute pause behavior and explicit resume behavior for parent-review-driven rework.",
      "acceptanceCriteria": [
        "CLI execute tests cover parent review pass (no pause) and fail (pause with guidance).",
        "CLI resume tests cover pending parent-feedback branch and legacy waiting-user branch.",
        "Tests verify pending feedback is cleared after successful feedback-based resume.",
        "go test ./internal/cli/... passes with deterministic output assertions."
      ],
      "prompt": "Add/extend tests in internal/cli/execute_test.go and internal/cli/resume_test.go (or new focused test files) to validate the parent review CLI flow end-to-end using deterministic fixtures.",
      "parentId": "prqg_05",
      "childIds": [],
      "deps": [
        "prqg_05b",
        "prqg_05c"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T07:07:29.583526Z"
    },
    "prqg_06": {
      "id": "prqg_06",
      "title": "TUI Parent Review Failure Modal and Resume Actions",
      "description": "Add explicit TUI handling for parent review failures, including a dedicated modal and explicit resume actions for identified child tasks with injected feedback.",
      "acceptanceCriteria": [
        "TUI can detect parent review required outcomes and surface them as an explicit action-required modal.",
        "Modal shows parent review result details, resume-target child list, and feedback text.",
        "Users can explicitly resume selected/all identified child tasks with feedback; no auto-resume by default.",
        "TUI tests cover modal rendering, key handling, action dispatch, and compatibility with existing review checkpoint UX."
      ],
      "prompt": "Implement the parent-review failure UX in internal/tui with minimal duplication from existing review checkpoint patterns. Reuse shared execution commands and keep state transitions deterministic.",
      "parentId": null,
      "childIds": [
        "prqg_06a",
        "prqg_06b",
        "prqg_06c",
        "prqg_06d",
        "prqg_06e"
      ],
      "deps": [
        "prqg_02",
        "prqg_04"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T07:37:11.706983Z"
    },
    "prqg_06a": {
      "id": "prqg_06a",
      "title": "Add TUI State for Pending Parent Feedback and Review Alerts",
      "description": "Extend the TUI model/loaders with parent-review pending-feedback awareness so action hints and resume affordances can include tasks flagged by parent reviews.",
      "acceptanceCriteria": [
        "Model state includes pending parent-feedback data keyed by child task ID.",
        "Run/feedback data loading refreshes pending feedback on timer and after execute/resume actions.",
        "State updates do not regress existing runData loading and review-checkpoint detection behavior.",
        "Tests cover loader behavior and state merge/update semantics."
      ],
      "prompt": "Update internal/tui/model.go and internal/tui/run_loader.go (or companion loaders) to ingest pending parent-feedback state from execution storage. Keep refresh cadence and failure handling aligned with current patterns. Verify by adding loader/state tests and running `go test ./internal/tui -run Loader` (or equivalent targeted tests).",
      "parentId": "prqg_06",
      "childIds": [],
      "deps": [
        "prqg_02c",
        "prqg_04c"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T07:13:34.023383Z"
    },
    "prqg_06b": {
      "id": "prqg_06b",
      "title": "Implement Parent Review Result Modal",
      "description": "Add a dedicated modal for parent review failures that presents parent context, resume targets, and feedback details with explicit user actions.",
      "acceptanceCriteria": [
        "A new modal form/component exists for parent review failures with deterministic rendering.",
        "Modal displays parent task details, failing review outcome, child resume target list, and feedback content.",
        "Key handling supports target navigation and explicit actions (resume selected, resume all, dismiss).",
        "Component tests verify render output and key-state transitions."
      ],
      "prompt": "Create a parent review modal in internal/tui (new file and tests) using existing modal patterns. Keep visual structure and key mapping consistent with established TUI interaction conventions.",
      "parentId": "prqg_06",
      "childIds": [],
      "deps": [
        "prqg_06a"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T07:18:40.840004Z"
    },
    "prqg_06c": {
      "id": "prqg_06c",
      "title": "Wire Execute Result Handling to Open Parent Review Modal",
      "description": "Hook the new execution stop reason into model update flow so parent-review-required outcomes open the dedicated modal and pause normal execution UX.",
      "acceptanceCriteria": [
        "Model update handling for `ExecuteActionComplete` opens the parent review modal when stop reason is `parent_review_required`.",
        "Action-progress state is reset before modal state is set, and this transition is covered by tests.",
        "Regression tests verify existing `waiting_user` and `decision_required` stop-reason handling remains unchanged.",
        "Tests verify modal dismissal returns to normal view state without stale parent-review modal data."
      ],
      "prompt": "Update internal/tui/model.go execution result handling to route `parent_review_required` outcomes into the new modal/action mode. Preserve existing handling for `waiting_user` and `decision_required` reasons. Verify with model-state tests covering modal open, dismiss, and non-parent stop reasons; run `go test ./internal/tui -run ExecuteActionComplete` (or equivalent).",
      "parentId": "prqg_06",
      "childIds": [],
      "deps": [
        "prqg_06b",
        "prqg_05a"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T07:25:31.504305Z"
    },
    "prqg_06d": {
      "id": "prqg_06d",
      "title": "Add TUI Resume Commands for Parent-Review Targets",
      "description": "Wire modal actions and main-view resume shortcuts to execute feedback-based resumes for pending parent-review targets.",
      "acceptanceCriteria": [
        "TUI command wrappers expose resume-with-pending-feedback operations for one child and multiple children.",
        "Main-view resume eligibility includes tasks with pending parent feedback, not only waiting_user tasks.",
        "Bottom bar/help text reflects the expanded resume behavior.",
        "Action outputs report per-task success/failure consistently with existing resume messaging."
      ],
      "prompt": "Update internal/tui/action_wrappers.go, internal/tui/actions.go, internal/tui/model.go, and internal/tui/bottom_bar.go to support explicit resume of parent-review targets using shared execution plumbing. Verify by adding/adjusting tests for single-target resume, multi-target resume, eligibility updates, and help text, then run `go test ./internal/tui -run Resume` (or equivalent targeted tests).",
      "parentId": "prqg_06",
      "childIds": [],
      "deps": [
        "prqg_06b",
        "prqg_04c"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T07:33:17.508595Z"
    },
    "prqg_06e": {
      "id": "prqg_06e",
      "title": "Add TUI Parent Review Flow Regression Tests",
      "description": "Add focused tests ensuring parent review failure handling, modal interactions, and resume actions remain stable across future TUI changes.",
      "acceptanceCriteria": [
        "Tests cover opening the parent review modal from execute results and dismiss/resume actions.",
        "Tests cover [u] resume behavior when pending parent feedback exists.",
        "Tests cover no-regression behavior for existing waiting_user resume and review checkpoint modals.",
        "go test ./internal/tui/... passes with deterministic fixtures."
      ],
      "prompt": "Implement regression tests across internal/tui/model*_test.go, modal tests, and wrapper tests to validate the full parent-review-required UX path and resume command behavior.",
      "parentId": "prqg_06",
      "childIds": [],
      "deps": [
        "prqg_06c",
        "prqg_06d"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T07:37:11.706983Z"
    },
    "prqg_07": {
      "id": "prqg_07",
      "title": "End-to-End Validation and Documentation Sync",
      "description": "Finalize implementation quality by adding cross-layer integration coverage, running full validation, and updating user/developer documentation to reflect shipped parent-review behavior.",
      "acceptanceCriteria": [
        "Execution integration tests validate trigger, idempotence, review fail linkage, and resume-with-feedback behavior.",
        "CLI and TUI regression suites pass with new parent-review flows enabled.",
        "docs and spec files are updated to describe default pause-and-explicit-resume behavior accurately.",
        "AGENT_LOG includes a concise summary of implementation decisions and validation commands."
      ],
      "prompt": "Complete final verification and documentation alignment for parent review quality gate. Prioritize deterministic integration tests, then update specs/docs/log artifacts to match the delivered behavior.",
      "parentId": null,
      "childIds": [
        "prqg_07a",
        "prqg_07b",
        "prqg_07c"
      ],
      "deps": [
        "prqg_03",
        "prqg_04",
        "prqg_05",
        "prqg_06"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T07:52:15.642992Z"
    },
    "prqg_07a": {
      "id": "prqg_07a",
      "title": "Add Execution Integration Tests for Parent Review Cycle",
      "description": "Add high-value integration tests in internal/execution that cover full parent review lifecycle across trigger, review outcome, pending feedback persistence, and resume consumption.",
      "acceptanceCriteria": [
        "Tests simulate child completion leading to exactly one parent review run for a signature.",
        "Tests simulate failed parent review creating pending feedback for targeted children.",
        "Tests simulate child resume with feedback and subsequent re-review after new completion signature.",
        "Tests avoid flakes by using deterministic timestamps and scripted command fixtures."
      ],
      "prompt": "Create integration-style tests in internal/execution (new test file recommended) that exercise the complete parent review cycle from completion trigger to resume-with-feedback and idempotence re-check.",
      "parentId": "prqg_07",
      "childIds": [],
      "deps": [
        "prqg_02d",
        "prqg_03d",
        "prqg_04d"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T07:45:47.324509Z"
    },
    "prqg_07b": {
      "id": "prqg_07b",
      "title": "Run Cross-Package Regression Validation",
      "description": "Consolidate regression confidence across execution, CLI, and TUI by ensuring new tests and existing suites pass together and no behavior regressions remain.",
      "acceptanceCriteria": [
        "Targeted package suites for execution, cli, and tui pass after parent-review changes.",
        "Any nondeterministic assertions are stabilized before completion.",
        "Full go test ./... passes in the repository.",
        "Residual risks (if any) are captured in task notes or AGENT_LOG."
      ],
      "prompt": "Run regression validation in this order: `go test ./internal/execution/...`, `go test ./internal/cli/...`, `go test ./internal/tui/...`, then `go test ./...`. If any suite fails, fix deterministic issues (especially time/order-dependent assertions), rerun the failing suite, and repeat until targeted suites pass. Capture executed commands and remaining risks in `AGENT_LOG.md`. Mark the task done only when targeted suites and full-repo tests pass, or when unrelated pre-existing failures are documented with exact repro commands.",
      "parentId": "prqg_07",
      "childIds": [],
      "deps": [
        "prqg_05d",
        "prqg_06e",
        "prqg_07a"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T07:46:37Z"
    },
    "prqg_07c": {
      "id": "prqg_07c",
      "title": "Update Spec/Docs and Log Completion",
      "description": "Synchronize documentation and spec status with implemented behavior, including explicit pause-and-resume semantics and the separation of parent review from normal ready-task execution.",
      "acceptanceCriteria": [
        "`specs/improvements/PARENT_REVIEW_QUALITY_GATE.md` is updated to reflect shipped behavior, including explicit pause-on-fail and manual child resume flow.",
        "`docs/COMMANDS.md` documents CLI execute/review pause output and `blackbird resume \u003ctaskId\u003e` behavior when pending parent feedback exists.",
        "`docs/TUI.md` documents parent-review failure modal behavior and resume actions for selected/all child targets.",
        "`internal/execution/README.md` documents review run type fields and pending feedback storage/consumption integration points.",
        "`AGENT_LOG.md` includes a dated completion entry summarizing implementation decisions and listing validation commands from prqg_07b."
      ],
      "prompt": "Update the listed spec/docs files to match shipped parent-review quality gate behavior, then append `AGENT_LOG.md` with a completion summary and verification commands/results from prqg_07b. Verify completion by checking diffs for each documentation file and running `go test ./...` to confirm no regressions accompany the documentation sync.",
      "parentId": "prqg_07",
      "childIds": [],
      "deps": [
        "prqg_07b"
      ],
      "status": "done",
      "createdAt": "2026-02-09T05:17:08.214276Z",
      "updatedAt": "2026-02-09T07:52:15.642992Z"
    }
  }
}
